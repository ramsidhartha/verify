<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Technical Claim - Verifi Protocol</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar">
        <a href="index.html" class="navbar-logo">
            <svg class="logo-icon" viewBox="0 0 32 32" fill="none">
                <circle cx="16" cy="16" r="14" stroke="#0ea5e9" stroke-width="2" />
                <path d="M10 16L14 20L22 12" stroke="#0ea5e9" stroke-width="2.5" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            <span>Verifi Protocol</span>
        </a>
        <div class="navbar-links">
            <a href="index.html">Overview</a>
            <a href="marketplace.html">Task Marketplace</a>
            <a href="new-request.html" class="active">Create Claim</a>
            <a href="identity.html">Identity</a>
        </div>
        <button class="btn btn-secondary" data-wallet-btn>Connect Wallet</button>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header" style="text-align: center;">
            <h1>Create Technical Claim</h1>
            <p>Submit a verifiable technical claim that can be independently reproduced and validated by the community.
            </p>
        </div>

        <div class="two-column">
            <!-- Main Form -->
            <div>
                <div class="card">
                    <h3 style="margin-bottom: 24px;">Claim Definition</h3>

                    <div class="form-group">
                        <label class="form-label">Claim Title *</label>
                        <input type="text" class="form-input"
                            placeholder="e.g., Sorting algorithm processes 1M integers under 0.5s">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Claim Type *</label>
                        <div class="checkbox-grid">
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>Performance Benchmark</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>Algorithm Correctness</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>Security Property</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>ML / AI Result</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>Data Processing</span>
                            </label>
                            <label class="checkbox-item">
                                <input type="checkbox">
                                <span>Other Technical Claim</span>
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Claim Description</label>
                        <textarea class="form-textarea"
                            placeholder="Describe exactly what you are claiming. Be specific, measurable, and falsifiable."></textarea>
                        <p class="form-hint">Example: "The model achieves 98.5% accuracy on MNIST test set" or "The
                            smart contract is mathematically proven to prevent re-entrancy".</p>
                    </div>
                </div>

                <div class="card" style="margin-top: 24px;">
                    <h3 style="margin-bottom: 24px;">Replication & Validation</h3>

                    <div class="form-group">
                        <label class="form-label">Reproducibility Instructions</label>
                        <textarea class="form-textarea"
                            placeholder="Step-by-step instructions for reproducing the claim (commands, scripts, datasets, environment assumptions)."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Validation Criteria</label>
                        <textarea class="form-textarea"
                            placeholder="Define what conditions must be met for this claim to be considered verified."></textarea>
                    </div>
                </div>

                <div class="card" style="margin-top: 24px;">
                    <h3 style="margin-bottom: 24px;">Evidence & Artifacts</h3>

                    <div class="form-group">
                        <label class="form-label">Code Repository</label>
                        <input type="url" class="form-input" placeholder="https://github.com/username/repo">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Dataset / Artifact Links</label>
                        <input type="url" class="form-input" placeholder="https://huggingface.co/datasets/...">
                        <p class="form-hint">Links to datasets, model weights, logs, or other artifacts (GitHub,
                            Huggingface, IPFS, etc.)</p>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Execution Environment</label>
                        <input type="text" class="form-input" placeholder="e.g., Python 3.10, Ubuntu 22.04, 16GB RAM">
                    </div>
                </div>

                <div style="display: flex; gap: 16px; margin-top: 24px; justify-content: center;">
                    <button class="btn btn-secondary" type="button">Save Draft</button>
                    <button class="btn btn-primary" type="button" id="submitClaimBtn">Publish Claim</button>
                </div>

                <!-- Result Modal -->
                <div id="resultModal"
                    style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
                    <div class="card" style="max-width: 600px; max-height: 80vh; overflow-y: auto;">
                        <h3 style="margin-bottom: 16px;">✅ Claim Submitted Successfully</h3>
                        <p style="margin-bottom: 16px;">AI has generated the following verification tasks:</p>
                        <div id="tasksList"></div>
                        <button class="btn btn-primary" onclick="window.location.href='marketplace.html'"
                            style="margin-top: 16px;">View in Marketplace</button>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div>
                <div class="sidebar-card">
                    <h4>How Verification Works</h4>
                    <ul>
                        <li>Your claim will be broken into verification tasks by AI</li>
                        <li>Independent developers will reproduce your results</li>
                        <li>Successful verification earns them reputation</li>
                    </ul>
                </div>

                <div class="sidebar-card">
                    <h4>Reputation Mechanics</h4>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>If verified</strong> → your reputation increases.
                    </p>
                    <p style="font-size: 14px; color: var(--gray-600); margin-bottom: 12px;">
                        <strong>If disproven</strong> → your reputation decreases.
                    </p>
                    <p style="font-size: 13px; color: var(--gray-500);">
                        Validators stake their own reputation to verify your claim. High-quality evidence attracts
                        top-tier validators.
                    </p>
                </div>

                <div class="sidebar-card">
                    <h4>Verification Stake</h4>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 14px; color: var(--gray-600);">Reputation Stake</span>
                        <span style="font-size: 14px; font-weight: 600;">50 REP</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-size: 14px; color: var(--gray-600);">Protocol Fee</span>
                        <span style="font-size: 14px; font-weight: 600;">5 VER</span>
                    </div>
                    <p style="font-size: 12px; color: var(--gray-400); margin-top: 12px;">
                        * Staked amount is returned upon successful verification consensus.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-bottom">
                <span>&copy; 2024 Verifi Protocol. Decentralized Technical Truth.</span>
            </div>
        </div>
    </footer>

    <script src="js/api.js"></script>
    <script>
        document.getElementById('submitClaimBtn').addEventListener('click', async () => {
            const wallet = getWallet();
            if (!wallet) {
                showToast('Please connect your wallet first', 'error');
                connectWallet();
                return;
            }

            // Get form values
            const title = document.querySelector('input[placeholder*="Sorting algorithm"]').value;
            const description = document.querySelector('textarea[placeholder*="Describe exactly"]').value;
            const repo = document.querySelector('input[placeholder*="github.com"]').value;

            if (!title || !description) {
                showToast('Please fill in the title and description', 'error');
                return;
            }

            // Build context from form
            const claimTypes = [];
            document.querySelectorAll('.checkbox-grid input:checked').forEach(cb => {
                claimTypes.push(cb.nextElementSibling.textContent.trim());
            });
            const context = `Types: ${claimTypes.join(', ')}. Repository: ${repo || 'Not provided'}`;

            // Show loading
            const btn = document.getElementById('submitClaimBtn');
            btn.textContent = 'Submitting...';
            btn.disabled = true;

            try {
                const result = await api.submitClaim({
                    claim_text: `${title}: ${description}`,
                    author_wallet: wallet,
                    context: context
                });

                // Show result modal
                const modal = document.getElementById('resultModal');
                const tasksList = document.getElementById('tasksList');
                tasksList.innerHTML = result.tasks.map(task => `
                    <div style="background: var(--gray-50); padding: 12px; border-radius: 8px; margin-bottom: 8px;">
                        <strong>${task.description}</strong>
                        <p style="font-size: 13px; color: var(--gray-600); margin-top: 4px;">${task.instructions}</p>
                        <div style="font-size: 12px; color: var(--gray-500); margin-top: 8px;">
                            Est. ${task.estimated_minutes || 30} mins • ${task.min_validators || 2} validators needed
                        </div>
                    </div>
                `).join('');
                modal.style.display = 'flex';

                showToast('Claim submitted successfully!', 'success');
            } catch (error) {
                showToast('Failed to submit claim. Is the backend running?', 'error');
                console.error(error);
            } finally {
                btn.textContent = 'Publish Claim';
                btn.disabled = false;
            }
        });

        // Close modal on background click
        document.getElementById('resultModal').addEventListener('click', (e) => {
            if (e.target.id === 'resultModal') {
                e.target.style.display = 'none';
            }
        });
    </script>

    <!-- Web3 Integration -->
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.9.0/dist/ethers.umd.min.js"></script>
    <script src="js/web3.js"></script>
</body>

</html>